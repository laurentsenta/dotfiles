#! /bin/sh

set -o errexit          # Exit on most errors (see the manual)
set -o errtrace         # Make sure any error trap is inherited
set -o nounset          # Disallow expansion of unset variables
set -o pipefail         # Use last non-zero exit code in a pipeline
set -o xtrace           # Trace the execution of the script (debug)

[ "$(whoami)" != "root" ] && exec sudo -- "$0" "$@"

if [ "`uname`" = "Linux" ]; then
    apt-get -q -y install \
        vim \
        zsh \
        neovim \
        python3 \
        python3-dev \
        python3-pip \
        libfreetype6-dev \
        libncurses5-dev \
        libxft-dev \
        git \
        ack-grep \
        autojump \
        tree \
        colordiff \
        grc \
        htop \
        tmux \
        mosh
        # libpq-dev \
        # fluxgui \
        # xbacklight \
        # xclip
        # unison \
        # python \
        # python-dev \

    # `perf stat` cmd:
    apt-get -q -y install \
        linux-tools-common \
        linux-tools-generic \
        linux-tools-`uname -r`

    pip3 install --upgrade pip
    pip3 install \
        ipython \
        jupyter \
        matplotlib \
        virtualenv \
        virtualenvwrapper

    # pip3 install neovim
    # gem install neovim

    echo "Setting default java: 1.8"
    # echo oracle-java7-installer shared/accepted-oracle-license-v1-1 select true | /usr/bin/debconf-set-selections
    apt-get -q -y install oracle-java8-installer
    update-java-alternatives -s java-8-oracle

    echo "Setting up javascript"
    curl -o- https://raw.githubusercontent.com/creationix/nvm/v0.33.11/install.sh | bash

    # Services
    apt-get -q -y install \
        sysvinit-utils \
        ufw

    ufw allow ssh
    ufw allow http
    ufw allow https
    ufw allow 60000:61000/udp # mosh ports
    ufw enable
elif [ "`uname`" = 'Darwin' ]; then
    brew install python python3
    echo "checkout the logs to linkapps stuff"
    read
    brew install reattach-to-user-namespace tree macvim vim rename
    echo "checkout the logs to linkapps stuff"
    read
    brew install gettext # envsubst
    brew install coreutils
    brew link --force gettext
    brew install autojump tmux

    brew linkapps

    pip3 install ipython jupyter matplotlib virtualenv \
        virtualenvwrapper
    # brew install npm # TODO: setup nvm
    # npm install -g phonegap

    brew install sassc chromedriver
    brew install ctags neovim/neovim/neovim

    # npm install -g jshint firebase-tools
    # npm install -g karma karma-chrome-launcher karma-cljs-test
    # brew install go-delve/delve/delve

    brew linkapps
fi
