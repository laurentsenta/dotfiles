#! /bin/sh
[ "$(whoami)" != "root" ] && exec sudo -- "$0" "$@"

if [ "`uname`" = "Linux" ]; then
  apt-get -q -y install vim zsh neovim \
        python python-dev \
	python3 python3-dev \
	python3-pip \
  	libfreetype6-dev libncurses5-dev libxft-dev git \
  	ack-grep autojump tree colordiff grc htop tmux \
	unison mosh \
	libpq-dev fluxgui xbacklight xclip

  # `perf stat` cmd:
  apt-get -q -y install linux-tools-common linux-tools-generic \
      linux-tools-`uname -r`

  pip3 install --upgrade pip
  pip3 install neovim
  pip2 install neovim
  gem install neovim

  echo "Setting default java: 1.8"
  echo oracle-java7-installer shared/accepted-oracle-license-v1-1 select true | /usr/bin/debconf-set-selections
  apt-get -q -y install oracle-java8-installer
  update-java-alternatives -s java-8-oracle

  # Leiningen Clojure
  if [ ! `which lein` ]; then
    cd /usr/bin && wget https://raw.github.com/technomancy/leiningen/stable/bin/lein && chmod a+x lein;
    lein > /dev/null
  fi

  # Services
  apt-get -q -y install sysvinit-utils ufw

  pip3 install tmuxp ipython jupyter matplotlib virtualenv \
    virtualenvwrapper

  ufw allow ssh
  ufw allow http
  ufw allow https
  ufw allow 60000:61000/udp # mosh ports
  ufw enable


elif [ "`uname`" = 'Darwin' ]; then
  brew install python python3
  echo "checkout the logs to linkapps stuff"
  read
  brew install reattach-to-user-namespace unison tree macvim vim postgresql rename
  echo "checkout the logs to linkapps stuff"
  read
  brew install gettext # envsubst
  brew install coreutils
  brew link --force gettext

  brew tap d12frosted/emacs-plus
  brew install emacs-plus --with-cocoa --with-gnutls --with-librsvg --with-imagemagick --with-spacemacs-icon
  brew linkapps

  pip3 install tmuxp ipython jupyter matplotlib
  brew install npm
  npm install -g phonegap

  brew install sassc chromedriver
  brew install ctags neovim/neovim/neovim
  brew install sassc rename

  brew tap universal-ctags/universal-ctags
  brew install --HEAD universal-ctags

  pip install flake8
  npm install -g jshint firebase-tools
  npm install -g karma karma-chrome-launcher karma-cljs-test

  brew linkapps
fi
